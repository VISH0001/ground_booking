<!DOCTYPE html>
<html>
<body>

<h2>Cricket Slot Booking</h2>

<input id="email" placeholder="Email"><br><br>
<input id="password" type="password" placeholder="Password"><br><br>
<button onclick="login()">Login</button>

<hr>

<table border="1" id="table"></table>
<p id="msg"></p>

<script>
const API =
"https://script.google.com/macros/s/AKfycbyBvhm_rfMx8TgGAcFZmUVwpNJnYdRlvcThu4sf1DlTRz6kZutpzJWy3tFMZbJNmvXN/exec";

let EMAIL = "", PASSWORD = "";

function login() {
  EMAIL = email.value.trim();
  PASSWORD = password.value.trim();

  fetch(API, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      action: "login",
      email: EMAIL,
      password: PASSWORD
    })
  })
  .then(r => r.json())
  .then(r => {
    if (r !== "OK") {
      msg.innerText = "Login failed";
      return;
    }
    loadSlots();
  })
  .catch(() => msg.innerText = "Network error");
}

function loadSlots() {
  fetch(API + "?action=getSlots")
    .then(r => r.json())
    .then(render);
}

function render(slots) {
  let html =
    "<tr><th>Day</th><th>Date</th><th>Morning</th><th>Evening</th></tr>";

  slots.forEach(s => {
    html += `<tr>
      <td>${s.day}</td>
      <td>${s.date}</td>
      <td>${cell(s.date,'morning',s.morning)}</td>
      <td>${cell(s.date,'evening',s.evening)}</td>
    </tr>`;
  });

  table.innerHTML = html;
}

function cell(date, slot, value) {
  if (String(value).toLowerCase() === "open") {
    return `<button onclick="book('${date}','${slot}')">BOOK</button>`;
  }
  return value || "";
}

function book(date, slot) {
  fetch(API, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      action: "book",
      email: EMAIL,
      password: PASSWORD,
      date: date,
      slot: slot
    })
  })
  .then(r => r.json())
  .then(r => msg.innerText = r)
  .catch(() => msg.innerText = "Network error");
}
</script>

</body>
</html>
