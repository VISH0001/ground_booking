<!DOCTYPE html>
<html>
<body>

<h2>Cricket Slot Booking</h2>

<input id="email" placeholder="Email"><br><br>
<input id="password" type="password" placeholder="Password"><br><br>
<button onclick="login()">Login</button>

<hr>

<table border="1" id="table"></table>
<p id="msg"></p>

<script>
const API =
"https://script.google.com/macros/s/AKfycbyBvhm_rfMx8TgGAcFZmUVwpNJnYdRlvcThu4sf1DlTRz6kZutpzJWy3tFMZbJNmvXN/exec";

let EMAIL, PASSWORD;

function login() {
  EMAIL = email.value;
  PASSWORD = password.value;
  fetch(API, {
    method:"POST",
    body:JSON.stringify({action:"login",email:EMAIL,password:PASSWORD})
  })
  .then(r=>r.json())
  .then(load)
  .catch(e=>msg.innerText="Login failed");
}

function load() {
  fetch(API+"?action=getSlots")
    .then(r=>r.json())
    .then(render);
}

function render(slots) {
  let h="<tr><th>Day</th><th>Date</th><th>Morning</th><th>Evening</th></tr>";
  slots.forEach(s=>{
    h+=`<tr>
      <td>${s.day}</td>
      <td>${s.date}</td>
      <td>${cell(s.date,'morning',s.morning)}</td>
      <td>${cell(s.date,'evening',s.evening)}</td>
    </tr>`;
  });
  table.innerHTML=h;
}

function cell(d,s,v){
  if(String(v).toLowerCase()==="open")
    return `<button onclick="book('${d}','${s}')">BOOK</button>`;
  return v||"";
}

function book(date,slot){
  fetch(API,{
    method:"POST",
    body:JSON.stringify({action:"book",email:EMAIL,password:PASSWORD,date,slot})
  })
  .then(r=>r.json())
  .then(r=>msg.innerText=r)
  .catch(()=>msg.innerText="Error");
}
</script>

</body>
</html>
